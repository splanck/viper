module test_bug007;

bind Terminal = Viper.Terminal;
bind Fmt = Viper.Fmt;
bind String = Viper.String;
bind IO = Viper.IO;

bind "./storage/page";
bind "./storage/serializer";
bind "./storage/wal";
bind "./types";
bind "./table";
bind "./schema";

// Entity that has a WALManager field â€” same pattern as StorageEngine
entity TestEngine {
    expose WALManager wal;
    expose Boolean isPersistent;
    
    expose func init() {
        wal = new WALManager();
        wal.init();
        isPersistent = false;
    }
    
    expose func doInsert() -> Boolean {
        // This call on the entity field triggered BUG-FE-007
        if wal.isEnabled() {
            Terminal.Say("wal is enabled");
        } else {
            Terminal.Say("wal not enabled");
        }
        return true;
    }
}

func main() {
    var engine = new TestEngine();
    engine.init();
    engine.doInsert();
    Terminal.Say("done");
}

// test_hj_debug.zia â€” Minimal hash join debug test
module test_hj_debug;

bind Terminal = Viper.Terminal;
bind Fmt = Viper.Fmt;

bind "../executor";
bind "../types";

func main() {
    var exec = new Executor();
    exec.init();

    exec.executeSql("CREATE TABLE dept (id INTEGER PRIMARY KEY, name TEXT)");
    exec.executeSql("INSERT INTO dept VALUES (1, 'Eng')");

    exec.executeSql("CREATE TABLE emp (id INTEGER PRIMARY KEY, name TEXT, dept_id INTEGER)");
    exec.executeSql("INSERT INTO emp VALUES (1, 'Alice', 1)");

    // Test LEFT JOIN first (uses nested loop, not hash join)
    Terminal.Say("Testing LEFT JOIN (nested loop)...");
    var r1 = exec.executeSql("SELECT e.name, d.name FROM emp e LEFT JOIN dept d ON e.dept_id = d.id");
    if r1.success {
        Terminal.Say("LEFT JOIN: " + Fmt.Int(r1.rowCount()) + " rows");
    } else {
        Terminal.Say("LEFT JOIN Error: " + r1.message);
    }

    // Test INNER JOIN (hash join path)
    Terminal.Say("Testing INNER JOIN (hash join)...");
    var r2 = exec.executeSql("SELECT e.name, d.name FROM emp e INNER JOIN dept d ON e.dept_id = d.id");
    if r2.success {
        Terminal.Say("INNER JOIN: " + Fmt.Int(r2.rowCount()) + " rows");
    } else {
        Terminal.Say("INNER JOIN Error: " + r2.message);
    }
    Terminal.Say("Done.");
}

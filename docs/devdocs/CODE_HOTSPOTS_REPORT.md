# Viper C/C++ Hotspot Report

**Generated:** 2025-12-21

## Scope

- Reviewed C/C++ sources and headers under `src/` and `include/`.
- Hotspots computed via `cloc --by-file`, excluding test sources.
- Generated tables called out explicitly.

## Hotspot Inventory (Top C/C++ Files by SLOC, non-tests)

| File | SLOC | Notes |
|------|------|-------|
| `src/frontends/viperlang/Lowerer_Expr.cpp` | 2184 | Large expression lowering hub |
| `src/il/runtime/RuntimeSignatures.cpp` | 1972 | Runtime signature descriptor tables |
| `src/runtime/rt_network_http.c` | 1836 | HTTP/URL networking implementation |
| `src/runtime/rt_network.c` | 1372 | Core TCP/UDP networking |
| `src/vm/ops/generated/OpSchema.hpp` | 1210 | Generated opcode schema |
| `src/tools/rtgen/rtgen.cpp` | 1151 | Runtime signature generator |
| `src/frontends/pascal/BuiltinRegistry.cpp` | 1113 | Pascal builtin registry |
| `src/frontends/pascal/Lowerer_Stmt.cpp` | 1104 | Pascal statement lowering |
| `src/runtime/rt_input_pad.c` | 1100 | Gamepad backends |
| `src/runtime/rt_input.c` | 1080 | Keyboard/mouse input |
| `src/il/transform/SCCP.cpp` | 1075 | SCCP optimization pass |
| `src/frontends/pascal/SemanticAnalyzer_Expr.cpp` | 1056 | Pascal semantic analysis |
| `src/frontends/viperlang/Parser_Expr.cpp` | 1048 | ViperLang expression parsing |
| `src/runtime/rt_compress.c` | 1037 | Compression routines |
| `src/runtime/rt_archive.c` | 1021 | ZIP archive support |
| `src/il/verify/generated/SpecTables.cpp` | 974 | Generated verifier tables |
| `src/frontends/viperlang/Lexer.cpp` | 969 | ViperLang lexer |
| `src/il/verify/EhChecks.cpp` | 962 | EH verifier checks |
| `src/runtime/rt_regex.c` | 958 | Regex engine |
| `src/codegen/aarch64/InstrLowering.cpp` | 941 | AArch64 instruction lowering |

## Large Generated Tables (Non-C/C++ Extensions)

| File | SLOC | Notes |
|------|------|-------|
| `src/il/runtime/generated/RuntimeSignatures.inc` | 5831 | Generated by `rtgen`; checked-in snapshot |

## Cleanup / Refactor Actions (This Pass)

- **Runtime registry alignment**: removed duplicate signature entries, restored `rt_str_eq`, and marked terminal helpers as `kManualLowering` to match lowering behavior.
- **Archive directory lookup**: normalized trailing slashes when resolving directory entries in `rt_archive_has` and `rt_archive_info`.
- **ViperLang parser/sema fixes**: disambiguated postfix `?` vs ternary, fixed named-arg parsing, broadened identifier-like declaration handling, and allowed `new` for value types.

## Areas to Monitor (No Refactor Planned)

- **ViperLang `Lowerer_Expr.cpp`** remains large but segmented by expression kind; no mechanical split applied.
- **Networking and input** remain sizable, but protocol/backends are already separated.
- **Generated tables** (`OpSchema.hpp`, `SpecTables.cpp`, `RuntimeSignatures.inc`) are build artifacts and should not be hand-edited.

## Validation

- Build/test status tracked in `docs/devdocs/codex_work.md`.

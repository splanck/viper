module TestLexicalStrings;

// Test: String Literals - Basic, escape sequences, and interpolation

var passed: Integer = 0;
var failed: Integer = 0;

func checkStr(name: String, actual: String, expected: String) {
    if (actual == expected) {
        passed = passed + 1;
        Viper.Terminal.Say("PASS: " + name);
    } else {
        failed = failed + 1;
        Viper.Terminal.Say("FAIL: " + name + " - expected '" + expected + "', got '" + actual + "'");
    }
}

func checkLen(name: String, s: String, expected: Integer) {
    var len: Integer = Viper.String.get_Length(s);
    if (len == expected) {
        passed = passed + 1;
        Viper.Terminal.Say("PASS: " + name);
    } else {
        failed = failed + 1;
        Viper.Terminal.Say("FAIL: " + name + " - expected length " + Viper.String.FromInt(expected) + ", got " + Viper.String.FromInt(len));
    }
}

func start() {
    Viper.Terminal.Say("=== String Literal Tests ===");

    // Basic strings
    var s1: String = "hello";
    checkStr("Basic string", s1, "hello");

    var s2: String = "";
    checkLen("Empty string length", s2, 0);

    var s3: String = "Hello, World!";
    checkStr("String with punctuation", s3, "Hello, World!");

    // Escape sequences
    var esc1: String = "line1\nline2";
    checkLen("Newline escape length", esc1, 11);

    var esc2: String = "col1\tcol2";
    checkLen("Tab escape length", esc2, 9);

    var esc3: String = "back\\slash";
    checkStr("Backslash escape", esc3, "back\\slash");

    var esc4: String = "say \"hello\"";
    checkStr("Quote escape", esc4, "say \"hello\"");

    // String concatenation
    var cat1: String = "hello" + " " + "world";
    checkStr("Concatenation", cat1, "hello world");

    var cat2: String = "" + "test";
    checkStr("Empty concat", cat2, "test");

    // String interpolation - simple cases
    var x: Integer = 42;
    var interp1: String = "value is ${x}";
    checkStr("Integer interpolation", interp1, "value is 42");

    var y: Number = 3.14;
    var interp2: String = "pi is ${y}";
    var hasValue: Boolean = Viper.String.Has(interp2, "3.14");
    if (hasValue) {
        passed = passed + 1;
        Viper.Terminal.Say("PASS: Float interpolation");
    } else {
        failed = failed + 1;
        Viper.Terminal.Say("FAIL: Float interpolation - got '" + interp2 + "'");
    }

    var name: String = "Alice";
    var interp3: String = "Hello, ${name}!";
    checkStr("String interpolation", interp3, "Hello, Alice!");

    // NOTE: Complex expressions in interpolation may not work
    // Testing simple variable interpolation only for now

    // Unicode (basic test)
    var unicode1: String = "cafe";
    checkStr("ASCII string", unicode1, "cafe");

    // Report results
    Viper.Terminal.Say("=== Results ===");
    Viper.Terminal.Say("Passed: " + Viper.String.FromInt(passed));
    Viper.Terminal.Say("Failed: " + Viper.String.FromInt(failed));

    if (failed == 0) {
        Viper.Terminal.Say("RESULT: ok");
    } else {
        Viper.Terminal.Say("RESULT: fail");
    }
}

module TestEntityInheritance;

// Test: Entity inheritance

var passed: Integer = 0;
var failed: Integer = 0;

func check(name: String, actual: Integer, expected: Integer) {
    if (actual == expected) {
        passed = passed + 1;
    } else {
        failed = failed + 1;
        Viper.Terminal.Say("FAIL: " + name + " - expected " + Viper.String.FromInt(expected) + ", got " + Viper.String.FromInt(actual));
    }
}

func checkStr(name: String, actual: String, expected: String) {
    if (actual == expected) {
        passed = passed + 1;
    } else {
        failed = failed + 1;
        Viper.Terminal.Say("FAIL: " + name + " - expected '" + expected + "', got '" + actual + "'");
    }
}

// Base entity
entity Animal {
    hide String name;

    expose func init(n: String) {
        name = n;
    }

    expose func speak() -> String {
        return "...";
    }

    expose func getName() -> String {
        return name;
    }
}

// Derived entity
entity Dog extends Animal {
    hide String breed;

    expose func init(n: String, b: String) {
        name = n;
        breed = b;
    }

    override expose func speak() -> String {
        return "Woof!";
    }

    expose func getBreed() -> String {
        return breed;
    }
}

// Another derived entity
entity Cat extends Animal {
    expose func init(n: String) {
        name = n;
    }

    override expose func speak() -> String {
        return "Meow!";
    }
}

func start() {
    Viper.Terminal.Say("=== Entity Inheritance Tests ===");

    // Test base entity
    var a: Animal = new Animal("Generic");
    checkStr("Animal name", a.getName(), "Generic");
    checkStr("Animal speak", a.speak(), "...");

    // Test derived entity (Dog)
    var d: Dog = new Dog("Buddy", "Golden Retriever");
    checkStr("Dog name", d.getName(), "Buddy");
    checkStr("Dog breed", d.getBreed(), "Golden Retriever");
    checkStr("Dog speak", d.speak(), "Woof!");

    // Test another derived (Cat)
    var c: Cat = new Cat("Whiskers");
    checkStr("Cat name", c.getName(), "Whiskers");
    checkStr("Cat speak", c.speak(), "Meow!");

    // Polymorphism test - assign derived to base type
    var animal: Animal = new Dog("Rex", "German Shepherd");
    checkStr("Polymorphic speak", animal.speak(), "Woof!");

    // Report results
    Viper.Terminal.Say("=== Results ===");
    Viper.Terminal.Say("Passed: " + Viper.String.FromInt(passed));
    Viper.Terminal.Say("Failed: " + Viper.String.FromInt(failed));

    if (failed == 0) {
        Viper.Terminal.Say("RESULT: ok");
    } else {
        Viper.Terminal.Say("RESULT: fail");
    }
}

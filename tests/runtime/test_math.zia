module TestMath;

bind "./_support";

// EXPECT_OUT: RESULT: ok
// Tests for Viper.Math.* functions

func testTrigonometric() {
    setTest("Trigonometric");

    // Sin
    assertApprox(Viper.Math.Sin(0.0), 0.0, 0.000001, "sin(0)");
    assertApprox(Viper.Math.Sin(1.5707963), 1.0, 0.000001, "sin(pi/2)");

    // Cos
    assertApprox(Viper.Math.Cos(0.0), 1.0, 0.000001, "cos(0)");
    assertApprox(Viper.Math.Cos(3.1415926), -1.0, 0.000001, "cos(pi)");

    // Tan
    assertApprox(Viper.Math.Tan(0.0), 0.0, 0.000001, "tan(0)");
    assertApprox(Viper.Math.Tan(0.7853981), 1.0, 0.000001, "tan(pi/4)");

    // Asin
    assertApprox(Viper.Math.Asin(0.0), 0.0, 0.000001, "asin(0)");
    assertApprox(Viper.Math.Asin(1.0), 1.5707963, 0.000001, "asin(1)");

    // Acos
    assertApprox(Viper.Math.Acos(1.0), 0.0, 0.000001, "acos(1)");
    assertApprox(Viper.Math.Acos(0.0), 1.5707963, 0.000001, "acos(0)");

    // Atan
    assertApprox(Viper.Math.Atan(0.0), 0.0, 0.000001, "atan(0)");
    assertApprox(Viper.Math.Atan(1.0), 0.7853981, 0.000001, "atan(1)");

    // Atan2
    assertApprox(Viper.Math.Atan2(1.0, 1.0), 0.7853981, 0.000001, "atan2(1,1)");
    assertApprox(Viper.Math.Atan2(0.0, 1.0), 0.0, 0.000001, "atan2(0,1)");
}

func testHyperbolic() {
    setTest("Hyperbolic");

    assertApprox(Viper.Math.Sinh(0.0), 0.0, 0.000001, "sinh(0)");
    assertApprox(Viper.Math.Sinh(1.0), 1.1752011936, 0.000001, "sinh(1)");

    assertApprox(Viper.Math.Cosh(0.0), 1.0, 0.000001, "cosh(0)");
    assertApprox(Viper.Math.Cosh(1.0), 1.5430806348, 0.000001, "cosh(1)");

    assertApprox(Viper.Math.Tanh(0.0), 0.0, 0.000001, "tanh(0)");
    assertApprox(Viper.Math.Tanh(1.0), 0.7615941559, 0.000001, "tanh(1)");
}

func testExponential() {
    setTest("Exponential");

    // Exp
    assertApprox(Viper.Math.Exp(0.0), 1.0, 0.000001, "exp(0)");
    assertApprox(Viper.Math.Exp(1.0), 2.7182818, 0.000001, "exp(1)");

    // Log (natural)
    assertApprox(Viper.Math.Log(1.0), 0.0, 0.000001, "log(1)");
    assertApprox(Viper.Math.Log(2.7182818), 1.0, 0.000001, "log(e)");

    // Log10
    assertApprox(Viper.Math.Log10(1.0), 0.0, 0.000001, "log10(1)");
    assertApprox(Viper.Math.Log10(10.0), 1.0, 0.000001, "log10(10)");
    assertApprox(Viper.Math.Log10(100.0), 2.0, 0.000001, "log10(100)");

    // Log2
    assertApprox(Viper.Math.Log2(1.0), 0.0, 0.000001, "log2(1)");
    assertApprox(Viper.Math.Log2(2.0), 1.0, 0.000001, "log2(2)");
    assertApprox(Viper.Math.Log2(8.0), 3.0, 0.000001, "log2(8)");

    // Pow
    assertApprox(Viper.Math.Pow(2.0, 0.0), 1.0, 0.000001, "pow(2,0)");
    assertApprox(Viper.Math.Pow(2.0, 3.0), 8.0, 0.000001, "pow(2,3)");
    assertApprox(Viper.Math.Pow(9.0, 0.5), 3.0, 0.000001, "pow(9,0.5)");

    // Sqrt
    assertApprox(Viper.Math.Sqrt(0.0), 0.0, 0.000001, "sqrt(0)");
    assertApprox(Viper.Math.Sqrt(1.0), 1.0, 0.000001, "sqrt(1)");
    assertApprox(Viper.Math.Sqrt(4.0), 2.0, 0.000001, "sqrt(4)");
    assertApprox(Viper.Math.Sqrt(9.0), 3.0, 0.000001, "sqrt(9)");
}

func testRounding() {
    setTest("Rounding");

    // Floor
    assertApprox(Viper.Math.Floor(1.9), 1.0, 0.000001, "floor(1.9)");
    assertApprox(Viper.Math.Floor(1.1), 1.0, 0.000001, "floor(1.1)");
    assertApprox(Viper.Math.Floor(-1.1), -2.0, 0.000001, "floor(-1.1)");

    // Ceil
    assertApprox(Viper.Math.Ceil(1.1), 2.0, 0.000001, "ceil(1.1)");
    assertApprox(Viper.Math.Ceil(1.9), 2.0, 0.000001, "ceil(1.9)");
    assertApprox(Viper.Math.Ceil(-1.1), -1.0, 0.000001, "ceil(-1.1)");

    // Round
    assertApprox(Viper.Math.Round(1.4), 1.0, 0.000001, "round(1.4)");
    assertApprox(Viper.Math.Round(1.5), 2.0, 0.000001, "round(1.5)");
    assertApprox(Viper.Math.Round(1.6), 2.0, 0.000001, "round(1.6)");

    // Trunc
    assertApprox(Viper.Math.Trunc(1.9), 1.0, 0.000001, "trunc(1.9)");
    assertApprox(Viper.Math.Trunc(-1.9), -1.0, 0.000001, "trunc(-1.9)");
}

func testAbsoluteValue() {
    setTest("AbsoluteValue");

    // Abs (float)
    assertApprox(Viper.Math.Abs(5.0), 5.0, 0.000001, "abs(5.0)");
    assertApprox(Viper.Math.Abs(-5.0), 5.0, 0.000001, "abs(-5.0)");
    assertApprox(Viper.Math.Abs(0.0), 0.0, 0.000001, "abs(0.0)");

    // AbsInt
    assertEqInt(Viper.Math.AbsInt(5), 5, "absint(5)");
    assertEqInt(Viper.Math.AbsInt(-5), 5, "absint(-5)");
    assertEqInt(Viper.Math.AbsInt(0), 0, "absint(0)");
}

func testMinMax() {
    setTest("MinMax");

    // Min (float)
    assertApprox(Viper.Math.Min(1.0, 2.0), 1.0, 0.000001, "min(1,2)");
    assertApprox(Viper.Math.Min(2.0, 1.0), 1.0, 0.000001, "min(2,1)");
    assertApprox(Viper.Math.Min(-1.0, 1.0), -1.0, 0.000001, "min(-1,1)");

    // Max (float)
    assertApprox(Viper.Math.Max(1.0, 2.0), 2.0, 0.000001, "max(1,2)");
    assertApprox(Viper.Math.Max(2.0, 1.0), 2.0, 0.000001, "max(2,1)");
    assertApprox(Viper.Math.Max(-1.0, 1.0), 1.0, 0.000001, "max(-1,1)");

    // MinInt
    assertEqInt(Viper.Math.MinInt(1, 2), 1, "minint(1,2)");
    assertEqInt(Viper.Math.MinInt(2, 1), 1, "minint(2,1)");
    assertEqInt(Viper.Math.MinInt(-5, 5), -5, "minint(-5,5)");

    // MaxInt
    assertEqInt(Viper.Math.MaxInt(1, 2), 2, "maxint(1,2)");
    assertEqInt(Viper.Math.MaxInt(2, 1), 2, "maxint(2,1)");
    assertEqInt(Viper.Math.MaxInt(-5, 5), 5, "maxint(-5,5)");
}

func testClamp() {
    setTest("Clamp");

    // Clamp (float)
    assertApprox(Viper.Math.Clamp(5.0, 0.0, 10.0), 5.0, 0.000001, "clamp(5,0,10)");
    assertApprox(Viper.Math.Clamp(-5.0, 0.0, 10.0), 0.0, 0.000001, "clamp(-5,0,10)");
    assertApprox(Viper.Math.Clamp(15.0, 0.0, 10.0), 10.0, 0.000001, "clamp(15,0,10)");

    // ClampInt
    assertEqInt(Viper.Math.ClampInt(5, 0, 10), 5, "clampint(5,0,10)");
    assertEqInt(Viper.Math.ClampInt(-5, 0, 10), 0, "clampint(-5,0,10)");
    assertEqInt(Viper.Math.ClampInt(15, 0, 10), 10, "clampint(15,0,10)");
}

func testSign() {
    setTest("Sign");

    // Sgn (float)
    assertApprox(Viper.Math.Sgn(5.0), 1.0, 0.000001, "sgn(5.0)");
    assertApprox(Viper.Math.Sgn(-5.0), -1.0, 0.000001, "sgn(-5.0)");
    assertApprox(Viper.Math.Sgn(0.0), 0.0, 0.000001, "sgn(0.0)");

    // SgnInt
    assertEqInt(Viper.Math.SgnInt(5), 1, "sgnint(5)");
    assertEqInt(Viper.Math.SgnInt(-5), -1, "sgnint(-5)");
    assertEqInt(Viper.Math.SgnInt(0), 0, "sgnint(0)");
}

func testDegRad() {
    setTest("DegRad");

    // Deg (radians to degrees)
    assertApprox(Viper.Math.Deg(3.1415926), 180.0, 0.001, "deg(pi)");
    assertApprox(Viper.Math.Deg(1.5707963), 90.0, 0.001, "deg(pi/2)");
    assertApprox(Viper.Math.Deg(0.0), 0.0, 0.000001, "deg(0)");

    // Rad (degrees to radians)
    assertApprox(Viper.Math.Rad(180.0), 3.1415926, 0.000001, "rad(180)");
    assertApprox(Viper.Math.Rad(90.0), 1.5707963, 0.000001, "rad(90)");
    assertApprox(Viper.Math.Rad(0.0), 0.0, 0.000001, "rad(0)");
}

func testLerp() {
    setTest("Lerp");

    assertApprox(Viper.Math.Lerp(0.0, 10.0, 0.0), 0.0, 0.000001, "lerp(0,10,0)");
    assertApprox(Viper.Math.Lerp(0.0, 10.0, 1.0), 10.0, 0.000001, "lerp(0,10,1)");
    assertApprox(Viper.Math.Lerp(0.0, 10.0, 0.5), 5.0, 0.000001, "lerp(0,10,0.5)");
}

func testHypot() {
    setTest("Hypot");

    assertApprox(Viper.Math.Hypot(3.0, 4.0), 5.0, 0.000001, "hypot(3,4)");
    assertApprox(Viper.Math.Hypot(5.0, 12.0), 13.0, 0.000001, "hypot(5,12)");
    assertApprox(Viper.Math.Hypot(0.0, 5.0), 5.0, 0.000001, "hypot(0,5)");
}

func testFMod() {
    setTest("FMod");

    assertApprox(Viper.Math.FMod(5.5, 2.0), 1.5, 0.000001, "fmod(5.5,2)");
    assertApprox(Viper.Math.FMod(10.0, 3.0), 1.0, 0.000001, "fmod(10,3)");
    assertApprox(Viper.Math.FMod(7.0, 7.0), 0.0, 0.000001, "fmod(7,7)");
}

func start() {
    testTrigonometric();
    testHyperbolic();
    testExponential();
    testRounding();
    testAbsoluteValue();
    testMinMax();
    testClamp();
    testSign();
    testDegRad();
    testLerp();
    testHypot();
    testFMod();

    report();
}

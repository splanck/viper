if (NOT DEFINED BASIC_AST_DUMP)
    message(FATAL_ERROR "BASIC_AST_DUMP not set")
endif ()
if (NOT DEFINED BAS_FILE)
    message(FATAL_ERROR "BAS_FILE not set")
endif ()
if (NOT DEFINED GOLDEN)
    message(FATAL_ERROR "GOLDEN not set")
endif ()
execute_process(COMMAND ${BASIC_AST_DUMP} ${BAS_FILE} OUTPUT_VARIABLE out RESULT_VARIABLE res)
if (NOT res EQUAL 0)
    message(FATAL_ERROR "dump failed")
endif ()
file(READ ${GOLDEN} expected)
if (NOT out STREQUAL expected)
    message(FATAL_ERROR "AST mismatch\nExpected: ${expected}\nGot: ${out}")
endif ()
